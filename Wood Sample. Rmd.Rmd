---
title: "Sampling Strategy//Wood Placement"
author: "Practicum2"
date: "5/4/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r}
library(DeclareDesign)
library(knitr)
library(ggplot2)
library(grid)
library(gridExtra)
library(dplyr)
library(kableExtra)
```


## Measurement Goal & Measure

**Goal**: Place wood structures in the Sandy River to create novel channel conditions similar to the natural conditions in other Oregon rivers

Are there at least 80 large woody debri pieces placed per river mile?

## Source & Rationale & Unit

*Source*: Observations along mile stretches of the Sandy River

*Rationale*: Restoration efforts are measured with survey crews considering "large wood pieces" at least 25 ft in length and 12 inches in diameter. These can be observed directly along the Sandy River

*Unit*: individual large wood pieces

## Responsibility & Frequency

*Responsibility*: The Freshwater Trust will assemble a team headed by Restoration Project Managers to record numbers of wood pieces throughout the project area. Crews will be responsbile for taking accurate counts of wood per river mile.

*Frequency*: Tracking wood pieces will allow The Freshwater Trust to determine how the presence of wood debris aids in restoration goals (increase biodiversity, reduce the threat of floods, restore stream function). Sampling twice a year to begin will give a proper explanation of river activities.

## Declaring the population

Data that I used from a site apart of the larger Sandy River Basin (Still Creek Watershed) USDA October 2017 watershed restoration completion report of Still Creek in Mount Hood National Forest (apart of the Sandy River)

Mile Stretch ID #   Pieces of large wood observed
-----------        -----------------------------
1                   95
2                   80
3                   72
4                   83
5                   60
6                   77
                    
## Target Population & Challenges

*Target Population*: Each mile stretch of the Sandy River

*Challenge of drawing a representative sample*: The Sandy River stretches more than 70 miles with many side channels and tributaries. Making observations along this long strech is not something the Freshwater Trust may be able to do consistently

*Sampling procedure*: Stratified sampling to account for points in the river that would affect the outcome of the presence of wood pieces

```{r}
# river stretches 70 miles, data provided is at two points in time along those seventy miles (avg)
set.seed(200)
population <- declare_population(
  mile = add_level(N=140,
                   wood_est=draw_binary(N=N, prob = 0.5), #half of mile stretches contained at least 80 pieces of wood
                   improved=correlate(given = wood_est, rho = 0.85, draw_binary, prob = 0.5))) 

milesofriver <- population()

wood <- declare_estimands(mean(wood_est),
                                 label = "Ybar")
#kable(table(pop$wood_est,pop$improved)) %>% 
  #add_header_above(c("At Least 80 Pieces Present "=1, "River Improved"=2))

my_estimand <- declare_estimands(mean(wood_est),
                                 label = "Ybar")
```

```{r report-samp}
reporting <- declare_assignment(prob=0.7,
                  assignment_variable = "R")

sampling <- declare_sampling(strata=wood_est,
               strata_n=c(95,60))
```

```{r}
strata_weighted_mean <- function(data){
  data.frame(
    estimator_label = "strata_w_mean",
    estimand_labl = "Ybar",
    n = nrow (data), 
    stringsAsFactors = FALSE,
    
estimate = data %>% filter(R==1) %>% 
  group_by(recurring) %>% 
  summarise(mean=mean(improved)) %>% 
  mutate(sub.mean=mean*prop) %>% pull(sub.mean) %>% 
  sum())
}
```

```{r}

answer <- declare_estimator(
  improved_wood = tidy_estimator(strata_weighted_mean),
  estimand = my_estimand)

design <- population + my_estimand + reporting + sampling + answer


#diagnosis <- diagnose_design(design, sims = 2000)


```

